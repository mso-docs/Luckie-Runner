<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luckie Runner!</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="1200" height="600"></canvas>
        
        <!-- Game UI Overlay -->
        <div id="gameUI">
            <div id="healthWrapper">
                <div id="playerHealthIcon" aria-hidden="true"></div>
                <div id="healthBar">
                    <div id="healthFill"></div>
                </div>
            </div>
            
            <div id="inventoryPanel">
                <div class="hud-entry coin">
                    <span class="hud-icon coin-icon" aria-hidden="true"></span>
                    <span class="hud-label">x</span>
                    <span class="hud-value" id="hudCoins">0</span>
                </div>
                <div class="hud-entry rock">
                    <span class="hud-icon rock-icon" aria-hidden="true"></span>
                    <span class="hud-label">x</span>
                    <span class="hud-value" id="hudRocks">10</span>
                </div>
            </div>

            <div id="buffPanel" class="buff-panel hidden" aria-live="polite">
                <div class="buff-icon coffee-icon" aria-hidden="true"></div>
                <div class="buff-text">
                    <div class="buff-name">Coffee</div>
                    <div class="buff-timer" id="coffeeTimer">--:--</div>
                </div>
            </div>
        </div>

        <!-- Intro Speech Bubble -->
        <div id="speechBubble" class="speech-bubble" aria-live="polite" aria-hidden="true">
            <div class="speech-bubble__body">
                <p id="speechText"></p>
                <div class="speech-bubble__hint">Press Enter</div>
            </div>
        </div>

        <!-- Shop Ghost hint bubble -->
        <div id="shopGhostBubble" class="npc-bubble hidden" aria-hidden="true">
            Press Z to interact with me!
        </div>

        <!-- Inventory Overlay (loaded from separate file) -->
        <div id="inventoryContainer"></div>

        <!-- Shop Overlay (UI only) -->
        <div id="shopOverlay" class="shop-overlay hidden" aria-hidden="true">
            <div class="shop-window" role="dialog" aria-labelledby="shopTitle">
                <div class="shop-header">
                    <div class="shop-currency chip hp">
                        <span class="chip-label">HP</span>
                        <span class="chip-value">10/10</span>
                    </div>
                    <div class="shop-currency chip fp">
                        <span class="chip-label">FP</span>
                        <span class="chip-value">10/10</span>
                    </div>
                    <div class="shop-currency chip star">
                        <span class="chip-label">Star</span>
                        <span class="chip-value">10</span>
                    </div>
                    <div class="shop-currency chip coin">
                        <span class="chip-label">Coins</span>
                        <span class="chip-value">233</span>
                    </div>
                </div>

                <div class="shop-title" id="shopTitle">Which one?</div>

                <div class="shop-list">
                    <div class="shop-item is-selected">
                        <span class="shop-item-icon icon-mushroom" aria-hidden="true"></span>
                        <span class="shop-item-name">Mushroom</span>
                        <span class="shop-item-price">10 coins</span>
                    </div>
                    <div class="shop-item">
                        <span class="shop-item-icon icon-honey" aria-hidden="true"></span>
                        <span class="shop-item-name">Honey Syrup</span>
                        <span class="shop-item-price">10 coins</span>
                    </div>
                    <div class="shop-item">
                        <span class="shop-item-icon icon-honey" aria-hidden="true"></span>
                        <span class="shop-item-name">Honey Syrup</span>
                        <span class="shop-item-price">10 coins</span>
                    </div>
                    <div class="shop-item">
                        <span class="shop-item-icon icon-honey" aria-hidden="true"></span>
                        <span class="shop-item-name">Honey Syrup</span>
                        <span class="shop-item-price">10 coins</span>
                    </div>
                    <div class="shop-item">
                        <span class="shop-item-icon icon-pow" aria-hidden="true"></span>
                        <span class="shop-item-name">POW Block</span>
                        <span class="shop-item-price">? coins</span>
                    </div>
                    <div class="shop-item">
                        <span class="shop-item-icon icon-fire" aria-hidden="true"></span>
                        <span class="shop-item-name">Fire Flower</span>
                        <span class="shop-item-price">? coins</span>
                    </div>
                    <div class="shop-item">
                        <span class="shop-item-icon icon-fire" aria-hidden="true"></span>
                        <span class="shop-item-name">Fire Flower</span>
                        <span class="shop-item-price">? coins</span>
                    </div>
                </div>

                <div class="shop-footer">
                    <span class="footer-control stop">Z Stop</span>
                    <span class="footer-control confirm">Enter Confirm</span>
                </div>
            </div>
        </div>

        <!-- Chest Overlay -->
        <div id="chestOverlay" class="chest-overlay hidden" aria-hidden="true">
            <div class="chest-window" role="dialog" aria-labelledby="chestTitle">
                <div class="chest-header">
                    <div class="chest-icon" aria-hidden="true"></div>
                    <div class="chest-header__text">
                        <div class="chest-title" id="chestTitle">Treasure Chest</div>
                        <div class="chest-subtitle">Press E or Enter to close</div>
                    </div>
                    <button type="button" class="chest-close" aria-label="Close chest" data-action="close-chest">Ã—</button>
                </div>

                <div class="chest-body">
                    <div class="chest-items"></div>
                    <div class="chest-empty hidden">This chest is empty.</div>
                </div>

                <div class="chest-footer">
                    <button type="button" class="chest-take-all" data-action="take-all">Take all</button>
                    <span class="chest-hint">E / Enter to exit</span>
                </div>
            </div>
        </div>

        <!-- Start Menu -->
        <div id="startMenu" class="menu">
            <h1>Luckie Runner!</h1>
            <p>Help Luckie Puppy get to Beachside Boba Cafe on time!</p>
            <button id="startButton">Start Game</button>
            <button id="instructionsButton">Instructions</button>
        </div>

        <!-- Instructions Screen -->
        <div id="instructionsMenu" class="menu hidden">
            <h2>How to Play</h2>
            <div class="instructions">
                <p><strong>Movement:</strong> A/D or Arrow Keys</p>
                <p><strong>Jump:</strong> W or Space</p>
                <p><strong>Dash:</strong> Shift + Movement</p>
                <p><strong>Attack:</strong> Mouse Click (throw rocks)</p>
                <p><strong>Goal:</strong> Reach the flag at the end of the level!</p>
                <p><strong>Tip:</strong> Collect coins and avoid enemies along the way!</p>
            </div>
            <button id="backButton">Back</button>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverMenu" class="menu hidden">
            <h2>Game Over</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>Coins Collected: <span id="finalCoins">0</span></p>
            <button id="restartButton">Try Again</button>
            <button id="mainMenuButton">Main Menu</button>
        </div>

        <!-- Pause Menu -->
        <div id="pauseMenu" class="menu hidden">
            <h2>Paused!</h2>
            <button id="resumeButton">Resume?</button>
            
            <!-- Audio Controls -->
            <div class="audio-controls">
                <h3>Audio Settings</h3>
                
                <div class="volume-control">
                    <button id="muteButton">ðŸ”Š Mute</button>
                </div>
                
                <div class="volume-control">
                    <label for="masterVolume">Master Volume: <span id="masterVolumeValue">100%</span></label>
                    <input type="range" id="masterVolume" min="0" max="100" value="100" step="5">
                </div>
                
                <div class="volume-control">
                    <label for="musicVolume">Music Volume: <span id="musicVolumeValue">60%</span></label>
                    <input type="range" id="musicVolume" min="0" max="100" value="60" step="5">
                </div>
                
                <div class="volume-control">
                    <label for="sfxVolume">SFX Volume: <span id="sfxVolumeValue">80%</span></label>
                    <input type="range" id="sfxVolume" min="0" max="100" value="80" step="5">
                </div>
            </div>
            
            <button id="pauseMainMenuButton">Main Menu</button>
        </div>
    </div>

    <!-- Load inventory markup -->
    <script>
        const inventoryReady = fetch('ui/inventory.html')
            .then(res => res.text())
            .then(html => {
                const container = document.getElementById('inventoryContainer');
                if (container) {
                    container.innerHTML = html;
                }
            })
            .catch(() => {});
    </script>

    <!-- Core Game Scripts -->
    <script src="scripts/utils/InputManager.js"></script>
    <script src="scripts/utils/AudioManager.js"></script>
    <script src="scripts/utils/CollisionDetection.js"></script>
    
    <!-- Base Entity Classes -->
    <script src="scripts/core/Entity.js"></script>
    <script src="scripts/core/Projectile.js"></script>
    
    <!-- Manager Classes -->
    <script src="scripts/core/GameStateManager.js"></script>
    
    <!-- Player System -->
    <script src="scripts/player/Player.js"></script>
    <script src="scripts/player/PlayerAnimations.js"></script>
    
    <!-- Enemy System -->
    <script src="scripts/enemies/Enemy.js"></script>
    <script src="scripts/enemies/Slime.js"></script>
    
    <!-- Environment System -->
    <script src="scripts/environment/Background.js"></script>
    <script src="scripts/environment/Platform.js"></script>
    <script src="scripts/environment/Trap.js"></script>
    <script src="scripts/environment/LevelGenerator.js"></script>
    <script src="scripts/environment/PalmTreeManager.js"></script>
    <script src="scripts/environment/TestRoom.js"></script>
    
    <!-- Items and Collectibles -->
    <script src="scripts/items/Item.js"></script>
    <script src="scripts/items/Coin.js"></script>
    <script src="scripts/items/RockBag.js"></script>
    <script src="scripts/items/HealthPotion.js"></script>
    <script src="scripts/items/Coffee.js"></script>
    <script src="scripts/items/Chest.js"></script>
    <script src="scripts/items/Flag.js"></script>

    <!-- NPCs -->
    <script src="scripts/npcs/ShopGhost.js"></script>
    
    <!-- Game Logic -->
    <script src="scripts/Game.js"></script>
    
    <!-- Initialize Game -->
    <script>
        // Initialize the game when page loads, after inventory markup is injected
        window.addEventListener('load', () => {
            inventoryReady.finally(() => {
                const game = new Game('gameCanvas');
                window.game = game; // For debugging
            });
        });
    </script>
</body>
</html>
